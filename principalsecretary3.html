<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Principal Secretary Dashboard | PIMIS (Maximized View)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Principal Secretary PIMIS Dashboard" name="description">
    <meta content="Kingsway Business Systems LTD" name="author">
    <link rel="shortcut icon" href="https://pimisdev.treasury.go.ke/assets/images/favicon.ico">

    <link href="https://pimisdev.treasury.go.ke/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

    <style>
        /* 1. CORE LAYOUT & FUNCTIONAL STYLES */
        .apexcharts-canvas { position: relative; user-select: none; }
        .row.row-8-cols { display: flex; flex-wrap: wrap; margin-left: -5px; margin-right: -5px;}
        .row-8-cols > [class*="col-"] {
            flex: 0 0 12.5%; max-width: 12.5%; padding-left: 5px; padding-right: 5px;
        }

        /* 2. BASE DASHBOARD STYLES */
        body { background-color: #f0f2f5; }
        .card {
            border: none; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            transition: all 0.3s ease; 
        }

        /* Card Background Colors (Consistent) */
        .mini-stats-wid.card-total-projects { background-color: #e6f3ff; } 
        .mini-stats-wid.card-pipelined-projects { background-color: #e0f7fa; } 
        .mini-stats-wid.card-approved-projects { background-color: #e8f9ed; } 
        .mini-stats-wid.card-rejected-projects { background-color: #f0f0f0; } 
        .mini-stats-wid.card-committed-value { background-color: #ffe6f2; } 
        .mini-stats-wid.card-ongoing-projects { background-color: #e3f2fd; } 
        .mini-stats-wid.card-stalled-projects { background-color: #fffde7; } 
        .mini-stats-wid.card-returned-projects { background-color: #ffead1; } 
        .mini-stats-wid.card-data-compliance { background-color: #e8f9ed; } 

        /* Sizing and Spacing for 8 mini-cards */
        .mini-stats-wid .card-body { padding: 20px 15px; } 
        .mini-stats-wid .text-muted.fw-medium { font-size: 11px; margin-bottom: 5px !important; }
        .mini-stats-wid h4.mb-0 { font-size: 20px; font-weight: 700; }
        .mini-stat-icon.avatar-sm { min-width: 40px; max-width: 40px; height: 40px; margin-left: 10px; }
        .mini-stat-icon.rounded-circle { font-size: 18px; opacity: 0.8; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        
        /* 3. Enhanced Visual Pop and Hierarchy */
        .card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); 
            transform: translateY(-5px); 
        }
        
        /* Vertical Color Stripe for emphasis */
        .mini-stats-wid { border-left: 5px solid transparent; }

        /* Color Stripe Mapping */
        .mini-stats-wid.card-total-projects { border-left-color: #007bff; } 
        .mini-stats-wid.card-pipelined-projects { border-left-color: #17a2b8; } 
        .mini-stats-wid.card-approved-projects { border-left-color: #28a745; } 
        .mini-stats-wid.card-committed-value { border-left-color: #e83e8c; } 
        .mini-stats-wid.card-rejected-projects { border-left-color: #6c757d; } 
        .mini-stats-wid.card-ongoing-projects { border-left-color: #1e88e5; } 
        .mini-stats-wid.card-stalled-projects { border-left-color: #ffc107; } 
        .mini-stats-wid.card-returned-projects { border-left-color: #fd7e14; } 
        .mini-stats-wid.card-data-compliance { border-left-color: #00bcd4; } 

        /* General UI Styles */
        .page-content { padding: calc(70px + 24px) 24px 24px 24px; }
        .vertical-menu { background-color: #343a40; }
    </style>

</head>

<body data-sidebar="dark">
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <div class="navbar-brand-box">...</div>
                    <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect" id="vertical-menu-btn"><i class="fa fa-fw fa-bars"></i></button>
                    <div class="app-search d-lg-block"><strong>Kenya Revenue Authority</strong><br><strong>ROLE:</strong> Principal Secretary</div>
                </div>
                <div class="d-flex">...</div>
            </div>
        </header>
        
        <div class="vertical-menu">...</div>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0 font-size-18">Principal Secretary Dashboard</h4>
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">PIMIS</a></li>
                                        <li class="breadcrumb-item active">PS Dashboard</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row row-8-cols"> 
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-total-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Total Projects</p>
                                        <h4 class="mb-0">120</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-primary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-copy-alt font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-pipelined-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Pipelined</p>
                                        <h4 class="mb-0">45</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-info align-self-center">
                                        <span class="avatar-title"><i class="bx bx-git-branch font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-ongoing-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Ongoing</p>
                                        <h4 class="mb-0">25</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-info align-self-center">
                                        <span class="avatar-title"><i class="bx bx-play-circle font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-approved-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Approved</p>
                                        <h4 class="mb-0">30</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-success align-self-center">
                                        <span class="avatar-title"><i class="bx bx-check-double font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-committed-value"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Total Committed Value</p>
                                        <h4 class="mb-0">4.5 B</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-danger align-self-center">
                                        <span class="avatar-title"><i class="bx bx-dollar-circle font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-stalled-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Stalled</p>
                                        <h4 class="mb-0">10</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-secondary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-time-five font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-rejected-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Rejected</p>
                                        <h4 class="mb-0">15</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-secondary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-x-circle font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-data-compliance"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Data Compliance Score</p>
                                        <h4 class="mb-0">92%</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-success align-self-center">
                                        <span class="avatar-title"><i class="bx bx-shield-quarter font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                    </div>

                    <div class="row">
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Projects Awaiting **PS Final Approval** <span class="badge bg-danger float-end">2</span></h4>
                                    <p class="card-title-desc">Critical projects requiring final sign-off for implementation or cancellation.</p>
                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-centered table-nowrap mb-0">
                                            <thead>
                                                <tr><th>Project Name</th><th>Value (M)</th><th>Days Pending</th></tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>National Food Security Initiative</td><td>KES 950</td><td>1 day</td></tr>
                                                <tr><td>Digital Tax Management System V3</td><td>KES 420</td><td>3 days</td></tr>
                                                <tr><td>*Coastal Economic Zone*</td><td>KES 1,100</td><td>*On Hold*</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">PIM Appraisal Efficiency <span class="badge bg-info float-end">22 Days Avg.</span></h4>
                                    <p class="card-title-desc">Average turnaround time for projects moving through the PIM analysis stage.</p>
                                    <div id="appraisal-efficiency-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Total Value by Project Stage üìä</h4>
                                    <p class="card-title-desc">Cumulative monetary value (in Billion KES) by current project status.</p>
                                    <div id="project-value-stage-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Strategic Risk Score Distribution ‚ö†Ô∏è</h4>
                                    <p class="card-title-desc">Percentage of projects falling into defined risk bands (High, Medium, Low).</p>
                                    <div id="risk-score-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                         </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Appraisal Throughput Funnel üìâ</h4>
                                    <p class="card-title-desc">Project count drop-off across key PIM approval stages (Pipelined to PS Approval).</p>
                                    <div id="throughput-funnel-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Sectoral Budget Utilization üí∞</h4>
                                    <p class="card-title-desc">Approved Project Value vs. Annual Sectoral Budget (Top 4 Sectors).</p>
                                    <div id="budget-utilization-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div> 
            </div> 
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row"><div class="col-sm-6">2025 ¬© PIMIS.</div><div class="col-sm-6"><div class="text-sm-end d-none d-sm-block">Design &amp; Develop by Kingsway Business Systems LTD</div></div></div>
                </div>
            </footer>
        </div>
    </div>
    
    <script src="https://pimisdev.treasury.go.ke/assets/libs/jquery/jquery.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/node-waves/waves.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/apexcharts/apexcharts.min.js"></script>

    <script>
        // --- CHART 1: Appraisal Efficiency (Radial Bar - Unchanged) ---
        var efficiencyOptions = {
            series: [22], 
            chart: { height: 250, type: 'radialBar' },
            plotOptions: {
                radialBar: {
                    hollow: { size: '70%' },
                    dataLabels: {
                        name: { offsetY: -10, show: true, color: '#888', fontSize: '13px' },
                        value: { color: '#111', fontSize: '30px', show: true, formatter: function (val) { return val + " Days"; } }
                    }
                }
            },
            fill: { colors: ['#17a2b8'] },
            stroke: { lineCap: 'round' },
            labels: ['Avg. Stage Duration'],
        };
        var efficiencyChart = new ApexCharts(document.querySelector("#appraisal-efficiency-chart"), efficiencyOptions);
        efficiencyChart.render();
        
        // --- CHART 2: Total Value by Project Stage (Bar Chart) ---
        var valueStageOptions = {
            series: [{
                name: 'Value (KES Billion)',
                data: [1.5, 3.2, 0.8, 4.1, 0.5] // Pipelined, Ongoing, Approved, Stalled, Returned
            }],
            chart: {
                type: 'bar',
                height: 300,
                toolbar: { show: false }
            },
            plotOptions: {
                bar: { horizontal: false }
            },
            dataLabels: { enabled: true, formatter: function (val) { return val + "B"; } },
            xaxis: {
                categories: ['Pipelined', 'Ongoing', 'Approved', 'Stalled', 'Returned'],
            },
            yaxis: {
                 title: { text: 'Value (Billion KES)' } 
            },
            colors: ['#007bff', '#1e88e5', '#28a745', '#ffc107', '#fd7e14'], 
            grid: { borderColor: '#f1f1f1' }
        };
        var valueStageChart = new ApexCharts(document.querySelector("#project-value-stage-chart"), valueStageOptions);
        valueStageChart.render();

        // --- CHART 3: Strategic Risk Score Distribution (Donut Chart) ---
        var riskOptions = {
            series: [60, 30, 10], 
            chart: {
                height: 300,
                type: 'donut',
            },
            labels: ['Low Risk (60%)', 'Medium Risk (30%)', 'High Risk (10%)'],
            colors: ['#28a745', '#ffc107', '#dc3545'], 
            responsive: [{
                breakpoint: 480,
                options: { chart: { width: 200 }, legend: { position: 'bottom' } }
            }]
        };

        var riskChart = new ApexCharts(document.querySelector("#risk-score-chart"), riskOptions);
        riskChart.render();
        
        // --- CHART 4: Appraisal Throughput Funnel (Bar Chart) ---
        var funnelOptions = {
            series: [{
                name: 'Projects',
                data: [45, 38, 30, 2] // Pipelined, Director Review (38), Approved (30), PS Approval (2)
            }],
            chart: {
                type: 'bar',
                height: 300,
                toolbar: { show: false }
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '60%',
                    distributed: true, 
                    dataLabels: { position: 'top' }
                },
            },
            dataLabels: {
                enabled: true,
                offsetY: -20,
                style: { fontSize: '12px', colors: ['#304758'] },
                formatter: function (val) { return val; }
            },
            xaxis: {
                categories: ['Pipelined (45)', 'Director Review (38)', 'Approved (30)', 'PS Approval (2)'],
                labels: { rotate: -45, rotateAlways: true }
            },
            colors: ['#17a2b8', '#007bff', '#28a745', '#dc3545'],
            tooltip: { y: { formatter: function (val) { return val + " Projects"; } } }
        };
        var funnelChart = new ApexCharts(document.querySelector("#throughput-funnel-chart"), funnelOptions);
        funnelChart.render();
        
        // --- CHART 5: Sectoral Budget Utilization (Grouped Bar Chart) ---
        var budgetOptions = {
            series: [{
                name: 'Approved Project Value (B)',
                data: [0.8, 1.5, 0.4, 0.6] // Tech, Infra, Agri, Health
            }, {
                name: 'Budget Allocated (B)',
                data: [1.2, 2.0, 0.5, 1.0]
            }],
            chart: {
                type: 'bar',
                height: 300,
                toolbar: { show: false }
            },
            plotOptions: {
                bar: { horizontal: false, columnWidth: '70%', endingShape: 'rounded' }
            },
            dataLabels: { enabled: false },
            stroke: { show: true, width: 2, colors: ['transparent'] },
            xaxis: { categories: ['Technology', 'Infrastructure', 'Agriculture', 'Health'] },
            yaxis: { title: { text: 'Value (Billion KES)' } },
            fill: { opacity: 1 },
            colors: ['#28a745', '#007bff'], 
            tooltip: { y: { formatter: function (val) { return "KES " + val + " Billion" } } }
        };

        var budgetChart = new ApexCharts(document.querySelector("#budget-utilization-chart"), budgetOptions);
        budgetChart.render();

    </script>

    <script src="https://pimisdev.treasury.go.ke/assets/js/pages/dashboard.init.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/js/app.js"></script>

</body>
</html>