<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Principal Secretary Dashboard | PIMIS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Principal Secretary PIMIS Dashboard" name="description">
    <meta content="Kingsway Business Systems LTD" name="author">
    <link rel="shortcut icon" href="/assets/images/favicon.ico">

    <link href="https://pimisdev.treasury.go.ke/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <link href="https://pimisdev.treasury.go.ke/assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

    <style>
        /* 1. CORE LAYOUT & FUNCTIONAL STYLES */
        #tableDiv { min-height: 60vh; }
        .apexcharts-canvas { position: relative; user-select: none; }
        .row.row-8-cols { display: flex; flex-wrap: wrap; margin-left: -5px; margin-right: -5px;}
        .row-8-cols > [class*="col-"] {
            flex: 0 0 12.5%; max-width: 12.5%; padding-left: 5px; padding-right: 5px;
        }

        /* 2. BASE DASHBOARD STYLES (Background, Card Shapes, Colors) */
        body { background-color: #f0f2f5; }
        .card {
            border: none; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            transition: all 0.3s ease; 
        }

        /* Card Background Colors (Consistent with Director's Dashboard) */
        .mini-stats-wid.card-total-projects { background-color: #e6f3ff; } 
        .mini-stats-wid.card-pipelined-projects { background-color: #e0f7fa; } 
        .mini-stats-wid.card-approved-projects { background-color: #e8f9ed; } 
        .mini-stats-wid.card-rejected-projects { background-color: #f0f0f0; } 
        .mini-stats-wid.card-awaiting-review { background-color: #ffebe6; } 
        .mini-stats-wid.card-ongoing-projects { background-color: #e3f2fd; } 
        .mini-stats-wid.card-stalled-projects { background-color: #fffde7; } 
        .mini-stats-wid.card-returned-projects { background-color: #ffead1; } 

        /* Sizing and Spacing for 8 mini-cards */
        .mini-stats-wid .card-body { padding: 20px 15px; } 
        .mini-stats-wid .text-muted.fw-medium { font-size: 11px; margin-bottom: 5px !important; }
        .mini-stats-wid h4.mb-0 { font-size: 20px; font-weight: 700; }
        .mini-stat-icon.avatar-sm { min-width: 40px; max-width: 40px; height: 40px; margin-left: 10px; }
        .mini-stat-icon.rounded-circle { font-size: 18px; opacity: 0.8; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        
        /* 3. üåü Enhanced Visual Pop and Hierarchy üåü */

        /* Hover Pop Effect */
        .card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); 
            transform: translateY(-5px); 
        }
        
        /* Vertical Color Stripe for emphasis */
        .mini-stats-wid { border-left: 5px solid transparent; }

        /* Color Stripe Mapping */
        .mini-stats-wid.card-total-projects { border-left-color: #007bff; } 
        .mini-stats-wid.card-pipelined-projects { border-left-color: #17a2b8; } 
        .mini-stats-wid.card-approved-projects { border-left-color: #28a745; } 
        .mini-stats-wid.card-rejected-projects { border-left-color: #6c757d; } 
        .mini-stats-wid.card-awaiting-review { border-left-color: #dc3545; } 
        .mini-stats-wid.card-ongoing-projects { border-left-color: #1e88e5; } 
        .mini-stats-wid.card-stalled-projects { border-left-color: #ffc107; } 
        .mini-stats-wid.card-returned-projects { border-left-color: #fd7e14; } 

        /* General UI Styles */
        .page-content { padding: calc(70px + 24px) 24px 24px 24px; }
        .vertical-menu { background-color: #343a40; }
    </style>

</head>

<body data-sidebar="dark">
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <div class="navbar-brand-box">...</div>
                    <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect" id="vertical-menu-btn"><i class="fa fa-fw fa-bars"></i></button>
                    <div class="app-search d-lg-block"><strong>Kenya Revenue Authority</strong><br><strong>ROLE:</strong> Principal Secretary</div>
                </div>
                <div class="d-flex">...</div>
            </div>
        </header>
        
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <div id="sidebar-menu">
                    <ul class="metismenu list-unstyled" id="side-menu">
                        <li class="menu-title" key="t-menu">Menu</li>
                        <li><a href="/dashboard" class="waves-effect"><i class="bx bx-home-circle"></i><span key="t-dashboards">Dashboard</span></a></li>
                        <li>
                            <a href="javascript: void(0);" class="has-arrow waves-effect"><i class="bx bx-file"></i><span key="t-projects">Strategic Projects</span></a>
                            <ul class="sub-menu" aria-expanded="false">
                                <li><a href="javascript: void(0);" key="t-list">View All</a></li>
                                <li><a href="javascript: void(0);" key="t-priority">Priority Initiatives</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript: void(0);" class="has-arrow waves-effect"><i class="bx bx-user-circle"></i><span key="t-approvals">PS Approvals</span></a>
                            <ul class="sub-menu" aria-expanded="false">
                                <li><a href="javascript: void(0);" key="t-pending">Pending Decisions</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0 font-size-18">Principal Secretary Dashboard</h4>
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">PIMIS</a></li>
                                        <li class="breadcrumb-item active">PS Dashboard</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row row-8-cols"> 
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-total-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Total Projects</p>
                                        <h4 class="mb-0">120</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-primary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-copy-alt font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-pipelined-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Pipelined</p>
                                        <h4 class="mb-0">45</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-info align-self-center">
                                        <span class="avatar-title"><i class="bx bx-git-branch font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-ongoing-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Ongoing</p>
                                        <h4 class="mb-0">25</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-info align-self-center">
                                        <span class="avatar-title"><i class="bx bx-play-circle font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-approved-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Approved</p>
                                        <h4 class="mb-0">30</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-success align-self-center">
                                        <span class="avatar-title"><i class="bx bx-check-double font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-stalled-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Stalled</p>
                                        <h4 class="mb-0">10</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-secondary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-time-five font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>

                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-rejected-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Rejected</p>
                                        <h4 class="mb-0">15</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-secondary align-self-center">
                                        <span class="avatar-title"><i class="bx bx-x-circle font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-returned-projects"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">Returned</p>
                                        <h4 class="mb-0">8</h4>
                                    </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-warning align-self-center">
                                        <span class="avatar-title"><i class="bx bx-undo font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                        
                        <div class="col-md-auto col-sm-6">
                            <div class="card mini-stats-wid card-awaiting-review"> <div class="card-body">
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <p class="text-muted fw-medium">PS Approval</p>
                                        <h4 class="mb-0">2</h4> </div>
                                    <div class="mini-stat-icon avatar-sm rounded-circle bg-danger align-self-center">
                                        <span class="avatar-title"><i class="bx bx-user-check font-size-24"></i></span>
                                    </div>
                                </div>
                            </div></div>
                        </div>
                    </div>

                    <div class="row">
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Projects Awaiting **PS Final Approval** <span class="badge bg-danger float-end">2</span></h4>
                                    <p class="card-title-desc">Critical projects requiring final sign-off for implementation or cancellation.</p>
                                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                        <table class="table table-centered table-nowrap mb-0">
                                            <thead>
                                                <tr><th>Project Name</th><th>Value (M)</th><th>Days Pending</th></tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>National Food Security Initiative</td><td>KES 950</td><td>1 day</td></tr>
                                                <tr><td>Digital Tax Management System V3</td><td>KES 420</td><td>3 days</td></tr>
                                                <tr><td>*Coastal Economic Zone*</td><td>KES 1,100</td><td>*On Hold*</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">PIM Appraisal Efficiency <span class="badge bg-info float-end">20 Projects</span></h4>
                                    <p class="card-title-desc">Average turnaround time for projects moving through the PIM analysis stage.</p>
                                    <div id="appraisal-efficiency-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Total Value by Project Stage üìä</h4>
                                    <div id="project-value-stage-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                        </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title mb-4">Strategic Risk Score Distribution ‚ö†Ô∏è</h4>
                                    <div id="risk-score-chart" class="apexcharts-canvas" style="min-height: 300px;">
                                         </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div> 
            </div> 
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row"><div class="col-sm-6">2025 ¬© PIMIS.</div><div class="col-sm-6"><div class="text-sm-end d-none d-sm-block">Design &amp; Develop by Kingsway Business Systems LTD</div></div></div>
                </div>
            </footer>
        </div>
    </div>
    
    <script src="https://pimisdev.treasury.go.ke/assets/libs/jquery/jquery.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/node-waves/waves.min.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/libs/apexcharts/apexcharts.min.js"></script>

    <script>
        // --- CHART 1: Appraisal Efficiency (Gauge/Radial Bar) ---
        var efficiencyOptions = {
            series: [22], // Average days to move to the next stage
            chart: {
                height: 250,
                type: 'radialBar',
            },
            plotOptions: {
                radialBar: {
                    hollow: {
                        size: '70%',
                    },
                    dataLabels: {
                        showOn: 'always',
                        name: {
                            offsetY: -10,
                            show: true,
                            color: '#888',
                            fontSize: '13px'
                        },
                        value: {
                            color: '#111',
                            fontSize: '30px',
                            show: true,
                            formatter: function (val) {
                                return val + " Days";
                            }
                        }
                    }
                }
            },
            fill: {
                colors: ['#17a2b8']
            },
            stroke: {
                lineCap: 'round'
            },
            labels: ['Avg. Stage Duration'],
        };
        var efficiencyChart = new ApexCharts(document.querySelector("#appraisal-efficiency-chart"), efficiencyOptions);
        efficiencyChart.render();

        // --- CHART 2: Project Value by Stage (Bar Chart) ---
        var valueStageOptions = {
            series: [{
                name: 'Value (KES Billion)',
                data: [1.5, 3.2, 0.8, 4.1, 0.5]
            }],
            chart: {
                type: 'bar',
                height: 300,
                toolbar: { show: false }
            },
            plotOptions: {
                bar: { horizontal: true }
            },
            dataLabels: { enabled: true, formatter: function (val) { return val + "B"; } },
            xaxis: {
                categories: ['Pipelined', 'Ongoing', 'Approved', 'Stalled', 'Returned'],
                labels: { show: false }
            },
            colors: ['#007bff'],
            grid: { borderColor: '#f1f1f1' }
        };
        var valueStageChart = new ApexCharts(document.querySelector("#project-value-stage-chart"), valueStageOptions);
        valueStageChart.render();

        // --- CHART 3: Strategic Risk Score Distribution (Donut Chart) ---
        var riskOptions = {
            series: [60, 30, 10], // Percentage of project count
            chart: {
                height: 300,
                type: 'donut',
            },
            labels: ['Low Risk (60%)', 'Medium Risk (30%)', 'High Risk (10%)'],
            colors: ['#28a745', '#ffc107', '#dc3545'], // Green, Yellow, Red
            responsive: [{
                breakpoint: 480,
                options: { chart: { width: 200 }, legend: { position: 'bottom' } }
            }]
        };

        var riskChart = new ApexCharts(document.querySelector("#risk-score-chart"), riskOptions);
        riskChart.render();

    </script>

    <script src="https://pimisdev.treasury.go.ke/assets/js/pages/dashboard.init.js"></script>
    <script src="https://pimisdev.treasury.go.ke/assets/js/app.js"></script>

</body>
</html>